(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{eywM:function(e,t,s){"use strict";var i=s("F/us"),a=s("0h2I"),o=s("RN+F"),n=s("Yjhd"),l=s("76Kh"),r=s("1grR"),h=s("20Ah"),c=s("oTCo");function u(){}u.prototype.ViewTemplate="SharedFiles_ButtonsView",u.prototype.useFilesViewData=function(e){this.isShareVisible=a.computed((function(){return!e.isCorporateStorage()})),this.shareCommand=n.createCommand(this,this.executeShare.bind(this,e),e.isShareAllowed),this.selectedSharedItems=a.computed((function(){return i.filter(e.selector.listCheckedAndSelected(),(function(e){return e.sharedWithMe()}))}),this),this.selectedSharedCount=a.computed((function(){return this.selectedSharedItems().length}),this),this.isLeaveShareAllowed=a.computed((function(){return!e.isZipFolder()&&!e.sharedParentFolder()&&this.selectedSharedCount()>0&&e.allSelectedFilesReady()}),this),this.leaveShareCommand=n.createCommand(this,this.executeLeaveShare.bind(this,e),this.isLeaveShareAllowed)},u.prototype.executeShare=function(e){var t=e.selector.itemSelected();t.IS_FILE&&t.bIsSecure()&&t.oExtendedProps&&!t.oExtendedProps.ParanoidKey?l.showPopup(r,[o.i18n("SHAREDFILES/INFO_SHARING_NOT_SUPPORTED"),null,o.i18n("SHAREDFILES/TITLE_SHARE_FILE")]):l.showPopup(c,[t])},u.prototype.executeLeaveShare=function(e){var t=e.selector.listCheckedAndSelected()||[],s=this.selectedSharedItems(),a=this.selectedSharedCount();if(!e.bPublic||a>0){var n=t.length!==a,r=!!i.find(s,(function(e){return!e.IS_FILE})),c=!!i.find(s,(function(e){return e.IS_FILE})),u="";u=n?o.i18n("SHAREDFILES/CONFIRM_NOT_ALL_ITEMS_SHARED"):r&&c?o.i18n("SHAREDFILES/CONFIRM_LEAVE_ITEMS_SHARE"):r?o.i18n("SHAREDFILES/CONFIRM_LEAVE_FOLDERS_SHARE_PLURAL",{NAME:s[0].fileName()},null,a):o.i18n("SHAREDFILES/CONFIRM_LEAVE_FILES_SHARE_PLURAL",{NAME:s[0].fileName()},null,a),e.selector.useKeyboardKeys(!1),l.showPopup(h,[u,function(t){t&&e.deleteItems(s,!0,"LeaveShare")},"",o.i18n("SHAREDFILES/ACTION_LEAVE_SHARE")])}},e.exports=new u},"o/8t":function(e,t,s){"use strict";var i=s("0h2I"),a=s("RN+F"),o=s("AFLV");e.exports=function(e){this.publicId=o.pString(e.PublicId),this.groupId=o.pInt(e.GroupId),this.isAllUsersGroup=o.pBool(e.IsAll),this.isNew=o.pBool(e.New),this.access=i.observable(o.pInt(e.Access)),this.accessText=i.computed((function(){switch(this.access()){case Enums.SharedFileAccess.Reshare:return a.i18n("SHAREDFILES/LABEL_RESHARE_ACCESS");case Enums.SharedFileAccess.Write:return a.i18n("SHAREDFILES/LABEL_WRITE_ACCESS");case Enums.SharedFileAccess.Read:return a.i18n("SHAREDFILES/LABEL_READ_ACCESS");default:return a.i18n("SHAREDFILES/LABEL_NOSHARE_ACCESS")}}),this)}},oTCo:function(e,t,s){"use strict";(function(t){var i=s("F/us"),a=s("0h2I"),o=s("RN+F"),n=s("AFLV"),l=s("o0Bx"),r=s("1grR"),h=s("JFZZ"),c=s("IAk5"),u=s("czxF"),d=s("20Ah"),S=s("OgeD"),p=s("76Kh"),m=s("SQrT"),E=s("o/8t"),A=S.run("ActivityHistory","getShowHistoryPopup");function I(){u.call(this),this.fileItem=null,this.isFileEncrypted=!1,this.hintText=a.observable(""),this.accessList=a.computed((function(){return[{value:Enums.SharedFileAccess.Read,label:o.i18n("SHAREDFILES/LABEL_READ_ACCESS")},{value:Enums.SharedFileAccess.Write,label:o.i18n("SHAREDFILES/LABEL_WRITE_ACCESS")},{value:Enums.SharedFileAccess.Reshare,label:o.i18n("SHAREDFILES/LABEL_RESHARE_ACCESS")},{value:Enums.SharedFileAccess.NoAccess,label:o.i18n("SHAREDFILES/LABEL_NOSHARE_ACCESS")}]}),this),this.shares=a.observableArray([]),this.sharesScrollAreaDom=a.observable(null),this.selectedTeammateDom=a.observable(null),this.selectedTeammateDom.subscribe((function(){this.selectedTeammateDom().on("click",function(){""!==this.selectedTeammateEmail()&&(t(this.selectedTeammateDom().autocomplete("widget")).is(":visible")||this.selectedTeammateDom().autocomplete("search"))}.bind(this))}),this),this.selectedTeammateEmail=a.observable(""),this.selectedTeammateData=a.observable(null),this.selectedTeammateData.subscribe((function(){this.selectedTeammateData()&&this.selectedTeammateEmail(this.selectedTeammateData().email)}),this),this.selectAccessDom=a.observable(null),this.lastRecievedSuggestList=[],this.isSaving=a.observable(!1),this.loadingFileShares=a.observable(!1),this.bAllowShowHistory=!!A}i.extendOwn(I.prototype,u.prototype),I.prototype.PopupTemplate="SharedFiles_FilesSharePopup",I.prototype.onOpen=function(e=null,t=null){if(null===e)return void this.closePopup();this.fileItem=e;e&&e.oExtendedProps;this.isFileEncrypted=!(!e.oExtendedProps||!e.oExtendedProps.InitializationVector),this.expungeFileItems=t,this.hintText(""),this.selectedTeammateEmail(""),this.selectedTeammateData(null),c.broadcastEvent("SharedFiles::OpenFilesSharePopup",{DialogHintText:this.hintText,IsDir:!e.IS_FILE}),this.fillUpShares(),this.requestFileShares(function(e,t){this.updateFileShares(e,t),this.fillUpShares()}.bind(this))},I.prototype.fillUpShares=function(){const e=this.fileItem&&this.fileItem.oExtendedProps,t=n.pArray(e&&e.Shares);this.shares(i.map(t,(function(e){return new E(e)})))},I.prototype.requestFileShares=function(e){const t=this.fileItem,s={Type:t.storageType(),Path:t.path(),Name:t.fileName()};this.loadingFileShares(!0),l.send("Files","GetExtendedProps",s,function(t,s){if(this.loadingFileShares(!1),t&&t.Result&&t.Result.Shares){const s=n.pEnum(t.Result.SharedWithMeAccess,Enums.SharedFileAccess,Enums.SharedFileAccess.NoAccess);e(s,t.Result.Shares)}else e(Enums.SharedFileAccess.NoAccess,[])}.bind(this))},I.prototype.updateFileShares=function(e,t){if(!this.fileItem)return;const s=this.fileItem.oExtendedProps;if(n.pInt(s&&s.SharedWithMeAccess)!==e&&this.fileItem.sharedWithMe()&&e===Enums.SharedFileAccess.NoAccess)return this.fileItem.deleted(!0),i.isFunction(this.expungeFileItems)&&this.expungeFileItems(),void this.closePopup();this.fileItem.updateExtendedProps({SharedWithMeAccess:e,Shares:n.pArray(t)}),this.fileItem.sharedWithMe()&&!this.fileItem.sharedWithMeAccessReshare()&&this.closePopup()},I.prototype.getCurrentShares=function(){return i.map(this.shares(),(function(e){const t=e.access();if(e.groupId)return{PublicId:e.publicId,Access:t,IsAll:e.isAllUsersGroup,IsGroup:!0,GroupId:e.groupId};{const s={PublicId:e.publicId,Access:t};return this.isFileEncrypted&&e.isNew&&(s.New=!0),s}}),this)},I.prototype.hasChanges=function(){var e=this.fileItem,t=n.pArray(e&&e.oExtendedProps&&e.oExtendedProps.Shares),s=this.getCurrentShares();return t=i.sortBy(t,"PublicId"),s=i.sortBy(s,"PublicId"),e&&(!i.isEqual(t,s)||this.selectedTeammateEmail())},I.prototype.onEscHandler=function(){this.cancelPopup()},I.prototype.cancelPopup=function(){this.isSaving()||(this.hasChanges()?p.showPopup(d,[o.i18n("COREWEBCLIENT/CONFIRM_DISCARD_CHANGES"),function(e){e&&this.closePopup()}.bind(this)]):this.closePopup())},I.prototype.autocompleteCallback=function(e,t){const s=this.fileItem;if(!this.fileItem)return void fResponse([]);const a={storage:"team",addContactGroups:!1,addUserGroups:!this.isFileEncrypted,exceptEmail:this.fileItem.sOwnerName},n=S.run("ContactsWebclient","getSuggestionsAutocompleteCallback",[a]),l=function(e){const i=s.sOwnerName.toLowerCase();let a=this.isFileEncrypted?e.filter(e=>e.hasKey):e;if(a=a.filter(e=>{const t=e.email.toLowerCase();return i!==t&&!this.shares().find(e=>e.publicId.toLowerCase()===t)}),this.lastRecievedSuggestList=a,a.length>0)t(a);else{const e=this.isFileEncrypted?"INFO_NO_SUGGESTED_CONTACTS_WITH_PGPKEY":"INFO_NO_SUGGESTED_CONTACTS";t([{label:o.i18n("SHAREDFILES/"+e),disabled:!0}])}}.bind(this);i.isFunction(n)&&(this.selectedTeammateData(null),n(e,l))},I.prototype.selectAccess=function(e,t){if(this.selectAccessDom().hasClass("expand"))this.selectAccessDom().removeClass("expand");else{if(null===this.selectedTeammateData()){var s=this.selectedTeammateEmail(),a=s.toLowerCase();if(""===s){var n=o.i18n("SHAREDFILES/WARNING_SELECT_TEAMMATE"),l=function(){this.selectedTeammateDom().focus(),this.selectedTeammateDom().autocomplete("option","minLength",0),this.selectedTeammateDom().autocomplete("search"),this.selectedTeammateDom().autocomplete("option","minLength",1)}.bind(this);p.showPopup(r,[n,l])}else{var h=i.find(this.lastRecievedSuggestList,function(e){return e.value.toLowerCase()===a||e.email.toLowerCase()===a||e.name.toLowerCase()===a}.bind(this));if(h)this.selectedTeammateData(h);else if(h=i.find(this.lastRecievedSuggestList,function(e){return-1!==e.value.toLowerCase().indexOf(a)}.bind(this))){var c=o.i18n("SHAREDFILES/CONFIRM_ADD_TEAMMATE",{EMAIL:h.email}),u=function(e){e?(this.selectedTeammateEmail(h.email),this.selectedTeammateData(h),this.selectAccessDom().addClass("expand")):(this.selectedTeammateDom().focus(),this.selectedTeammateDom().autocomplete("search"))}.bind(this),S=o.i18n("SHAREDFILES/ACTION_YES"),m=o.i18n("SHAREDFILES/ACTION_NO");p.showPopup(d,[c,u,"",S,m])}else{n=o.i18n("SHAREDFILES/WARNING_NO_TEAMMATE_SELECTED",{EMAIL:s}),l=function(){this.selectedTeammateDom().focus(),this.selectedTeammateDom().autocomplete("search")}.bind(this);p.showPopup(r,[n,l])}}}null!==this.selectedTeammateData()&&this.selectAccessDom().addClass("expand")}},I.prototype.addNewShare=function(e){if(!this.selectedTeammateData())return this.selectedTeammateDom().focus(),void this.selectedTeammateDom().autocomplete("search");this.shares.push(new E({PublicId:this.selectedTeammateData().email,GroupId:this.selectedTeammateData().groupId,IsAll:this.selectedTeammateData().isAllUsersGroup,Access:e,New:!0})),this.selectedTeammateData(null),this.selectedTeammateEmail("");var t=this.sharesScrollAreaDom(),s=null!==t?t.find(".shares_list"):null;null!==s&&t.scrollTop(s.height()-t.height())},I.prototype.deleteShare=function(e,t){t?this.shares(i.filter(this.shares(),(function(e){return e.groupId!==t}))):this.shares(i.filter(this.shares(),(function(t){return t.publicId!==e})))},I.prototype.checkAndSaveShares=function(){this.isSaving()||(this.isSaving(!0),this.requestFileShares(function(e,t){this.isSaving(!1);const s=this.fileItem;let a=s&&s.oExtendedProps,l=n.pArray(a&&a.Shares),h=n.pInt(a&&a.SharedWithMeAccess);if(t=i.sortBy(t,"PublicId"),l=i.sortBy(l,"PublicId"),i.isEqual(l,t)&&e===h)this.saveShares();else{const s=o.i18n("SHAREDFILES/WARNING_SHARES_CHANGED_BY_OTHER_USER"),i=function(){this.updateFileShares(e,t),this.fillUpShares()}.bind(this);p.showPopup(r,[s,i])}}.bind(this)))},I.prototype.saveShares=function(){if(!this.isSaving())if(this.selectedTeammateEmail()){var e=o.i18n("SHAREDFILES/CONFIRM_SAVE_SHARES_WITHOUT_LAST_EMAIL",{EMAIL:this.selectedTeammateEmail()}),t=function(e){e?this.confirmedSaveShares():setTimeout(this.selectAccess.bind(this))}.bind(this);p.showPopup(d,[e,t])}else this.confirmedSaveShares()},I.prototype.confirmedSaveShares=function(){if(!this.isSaving()){var e=this.getCurrentShares(),t={Storage:this.fileItem.storageType(),Path:this.fileItem.path(),Id:this.fileItem.id(),Shares:e,IsDir:!this.fileItem.IS_FILE},s=i.bind((function(){l.send("SharedFiles","UpdateShare",t,i.bind(this.onUpdateShareResponse,this))}),this),a=i.bind((function(){this.isSaving(!1)}),this);this.isSaving(!0),!1===c.broadcastEvent("SharedFiles::UpdateShare::before",{FileItem:this.fileItem,Shares:e,OnSuccessCallback:s,OnErrorCallback:a})&&s()}},I.prototype.onUpdateShareResponse=function(e,t){this.isSaving(!1),e.Result?this.requestFileShares(function(e,t){this.updateFileShares(e,t),m.showReport(o.i18n("SHAREDFILES/INFO_SHARING_STATUS_UPDATED")),this.fileItem=null,this.closePopup()}.bind(this)):h.showErrorByCode(e,o.i18n("SHAREDFILES/ERROR_UNKNOWN_ERROR"))},I.prototype.showHistory=function(){this.bAllowShowHistory&&p.showPopup(A,[o.i18n("SHAREDFILES/HEADING_HISTORY_POPUP"),this.fileItem])},e.exports=new I}).call(this,s("EVdn"))},uoSt:function(e,t,s){"use strict";e.exports=function(e){s("F/us");var t=s("IAk5"),i=null;return t.isUserNormalOrTenant()?{start:function(e){e.run("FilesWebclient","registerToolbarButtons",[(i||(i=s("eywM")),i)])},getFilesSharePopup:function(){return s("oTCo")}}:null}}}]);