(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{"2d9n":function(e,t,n){"use strict";var r=n("F/us"),o=n("0h2I"),i=n("RN+F"),s=n("czxF");function a(){s.call(this),this.fUpload=null,this.fCancel=null,this.message=o.observable(""),this.filesConfirmText=o.observable(""),this.sErrorText=o.observable("")}r.extendOwn(a.prototype,s.prototype),a.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_ConfirmUploadPopup",a.prototype.onOpen=function(e,t,n,o,s){var a=r.map(o,(function(e){return i.encodeHtml(e)}));this.filesConfirmText(""),this.fUpload=e,this.fCancel=t,this.message(i.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/CONFIRM_UPLOAD_PLURAL",{VALUE:n>1?n:'"'+o[0]+'"'},null,n)),n>1&&this.filesConfirmText(a.join("<br />")),this.sErrorText(s)},a.prototype.cancelUpload=function(){this.fCancel(),this.closePopup()},a.prototype.upload=function(){this.fUpload(),this.closePopup()},e.exports=new a},"2kfa":function(e,t,n){"use strict";var r=n("F/us"),o=n("0h2I"),i=n("IAk5"),s=n("czxF"),a=n("zDR0");function u(){s.call(this),this.keyName=o.observable(i.getUserPublicId()),this.fOnGenerateCallback=null}r.extendOwn(u.prototype,s.prototype),u.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_GenerateKeyPopup",u.prototype.onOpen=function(e){this.fOnGenerateCallback=e},u.prototype.generateKey=function(){a.generateAndExportKey(r.bind((function(){this.fOnGenerateCallback()}),this),this.keyName()),this.closePopup()},e.exports=new u},B9Yq:function(e,t){e.exports=function(){throw new Error("define cannot be used indirect")}},I5pT:function(e,t,n){"use strict";var r=n("0h2I"),o=n("F/us"),i=n("AFLV");e.exports={ServerModuleName:"CoreParanoidEncryptionWebclientPlugin",HashModuleName:"paranoid-encryption",EncryptionAllowedModules:["Files"],EncryptionAllowedStorages:["personal"],enableJscrypto:r.observable(!0),EnableInPersonalStorage:!1,ChunkSizeMb:5,AllowMultiChunkUpload:!0,AllowChangeSettings:!1,DontRemindMe:r.observable(!1),init:function(e){var t=o.extend({},e[this.ServerModuleName]||{},e.CoreParanoidEncryptionWebclientPlugin||{});o.isEmpty(t)||(this.enableJscrypto(i.pBool(t.EnableModule,this.enableJscrypto())),this.DontRemindMe(i.pBool(t.DontRemindMe,this.DontRemindMe())),this.EnableInPersonalStorage=i.pBool(t.EnableInPersonalStorage,this.EnableInPersonalStorage),this.ChunkSizeMb=i.pInt(t.ChunkSizeMb,this.ChunkSizeMb),this.AllowMultiChunkUpload=i.pBool(t.AllowMultiChunkUpload,this.AllowMultiChunkUpload),this.AllowChangeSettings=i.pBool(t.AllowChangeSettings,this.AllowChangeSettings))},update:function(e,t){this.enableJscrypto(e),this.EnableInPersonalStorage=t}}},LU2F:function(e,t,n){"use strict";var r=n("F/us"),o=n("0h2I"),i=n("czxF");function s(){i.call(this),this.keyPassword=o.observable(""),this.fOnPasswordEnterCallback=null,this.fOnCancellCallback=null}r.extendOwn(s.prototype,i.prototype),s.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_DecryptKeyPasswordPopup",s.prototype.onOpen=function(e,t){this.fOnPasswordEnterCallback=e,this.fOnCancellCallback=t},s.prototype.decryptKey=function(){r.isFunction(this.fOnPasswordEnterCallback)&&this.fOnPasswordEnterCallback(this.keyPassword()),this.closePopup()},s.prototype.cancelPopup=function(){r.isFunction(this.fOnCancellCallback)&&this.fOnCancellCallback(),this.closePopup()},s.prototype.onShow=function(){this.keyPassword("")},e.exports=new s},MYcH:function(e,t,n){"use strict";function r(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw s}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function i(e,t,n,r,o,i,s){try{var a=e[i](s),u=a.value}catch(e){return void n(e)}a.done?t(u):Promise.resolve(u).then(r,o)}function s(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var s=e.apply(t,n);function a(e){i(s,r,o,a,u,"next",e)}function u(e){i(s,r,o,a,u,"throw",e)}a(void 0)}))}}var a=n("F/us"),u=n("RN+F"),c=(n("AFLV"),n("OgeD")),l=n("SQrT"),p=c.run("OpenPgpWebclient","getOpenPgpEncryptor"),h=n("QJDP");function f(e){var t=e.map((function(e){return e.PublicId})),n=t.length?p.findKeysByEmails(t,!0):[];if(n.length<t.length){var r=n.map((function(e){return e.getEmail()})),o=t.filter((function(e){return!r.includes(e)})),i=u.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_NO_PUBLIC_KEYS_FOR_USERS_PLURAL",{USERS:o.join(", ")},null,o.length);return l.showError(i),!1}return n}function d(e){return y.apply(this,arguments)}function y(){return(y=s(regeneratorRuntime.mark((function e(t){var n,r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.getCurrentUserPrivateKey();case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return",!1);case 5:return e.next=7,p.askForKeyPassword(n.getUser());case 7:if(r=e.sent){e.next=10;break}return e.abrupt("return",!1);case 10:return e.next=12,h.decryptParanoidKey(t,r);case 12:return o=e.sent,e.abrupt("return",{decryptedParanoidKey:o,password:r});case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(){return(E=s(regeneratorRuntime.mark((function e(t){var n,o,i,s,u,c,l,p,y,E,C;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.isFunction(t.OnSuccessCallback)&&a.isFunction(t.OnErrorCallback)){e.next=2;break}return e.abrupt("return");case 2:if(n=t.FileItem,o=n&&n.oExtendedProps,i=o&&(n.sharedWithMe()?o.ParanoidKeyShared:o.ParanoidKey),n&&n.IS_FILE&&i&&a.isArray(t.Shares)){e.next=6;break}return t.OnSuccessCallback(),e.abrupt("return");case 6:if(0!==(s=t.Shares.filter((function(e){return e.New}))).length){e.next=10;break}return t.OnSuccessCallback(),e.abrupt("return");case 10:if(u=f(s)){e.next=14;break}return t.OnErrorCallback(),e.abrupt("return");case 14:return e.next=16,d(i);case 16:if(c=e.sent,l=c.decryptedParanoidKey,p=c.password,l){e.next=22;break}return t.OnErrorCallback(),e.abrupt("return");case 22:y=r(t.Shares),e.prev=23,C=regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=E.value,!(n=u.find((function(e){return e.emailParts.email===t.PublicId})))){e.next=8;break}return e.next=5,h.encryptParanoidKey(l,[n],p);case 5:(r=e.sent)&&(t.ParanoidKeyShared=r),delete t.New;case 8:case"end":return e.stop()}}),e)})),y.s();case 26:if((E=y.n()).done){e.next=30;break}return e.delegateYield(C(),"t0",28);case 28:e.next=26;break;case 30:e.next=35;break;case 32:e.prev=32,e.t1=e.catch(23),y.e(e.t1);case 35:return e.prev=35,y.f(),e.finish(35);case 38:t.OnSuccessCallback();case 39:case"end":return e.stop()}}),e,null,[[23,32,35,38]])})))).apply(this,arguments)}e.exports={onBeforeUpdateShare:function(e){return E.apply(this,arguments)}}},Npm9:function(e,t,n){"use strict";var r=n("F/us"),o=n("0h2I"),i=n("IAk5"),s=n("czxF"),a=n("zDR0");function u(){s.call(this),this.keyName=o.observable(i.getUserPublicId()),this.newKey=o.observable("")}r.extendOwn(u.prototype,s.prototype),u.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_ImportKeyStringPopup",u.prototype.onOpen=function(){this.newKey("")},u.prototype.importKey=function(){a.importKeyFromString(this.keyName(),this.newKey()),this.closePopup()},e.exports=new u},PDX0:function(e,t){(function(t){e.exports=t}).call(this,{})},QJDP:function(e,t,n){"use strict";function r(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function i(e,t,n,r,o,i,s){try{var a=e[i](s),u=a.value}catch(e){return void n(e)}a.done?t(u):Promise.resolve(u).then(r,o)}function s(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var s=e.apply(t,n);function a(e){i(s,r,o,a,u,"next",e)}function u(e){i(s,r,o,a,u,"throw",e)}a(void 0)}))}}var a=n("EVdn"),u=n("F/us"),c=n("OgeD"),l=n("SQrT"),p=n("RN+F"),h=n("uN/E"),f=n("zDR0"),d=n("Yjhd"),y=n("wjWM"),E=n("76Kh"),C=n("hJUJ"),b=n("TrqT"),P=n("I5pT"),R=c.run("OpenPgpWebclient","getOpenPgpEncryptor");function w(){this.iChunkNumber=0,this.iChunkSize=1024*P.ChunkSizeMb*1024,this.iCurrChunk=0,this.oChunk=null,this.iv=null,this.oChunkQueue={isProcessed:!1,aFiles:[]},this.aStopList=[],this.fOnUploadCancelCallback=null,this.oKey=null}function N(e,t,n,r,o){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this.oWriter=new g(e.fileName(),r),this.init(e,t,n,o,i)}function m(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.oWriter=null,this.init(e,t,n,null,r)}function g(e,t){this.sName=e,this.aBuffer=[],u.isFunction(t)&&(this.fProcessBlobCallback=t)}function O(e){this.sName=e,this.aBuffer=[],this.imgWindow=window.open("","_blank","height=auto, width=auto,toolbar=no,scrollbars=no,resizable=yes")}w.prototype.start=function(){var e=s(regeneratorRuntime.mark((function e(t){var n,r=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=r.length>1&&void 0!==r[1]?r[1]:"",this.oFileInfo=t,this.oFile=t.File,this.iChunkNumber=Math.ceil(t.File.size/this.iChunkSize),this.iCurrChunk=0,this.oChunk=null,this.iv=window.crypto.getRandomValues(new Uint8Array(16)),this.oFileInfo.Hidden={RangeType:1,Overwrite:!0},this.oFileInfo.Hidden.ExtendedProps={InitializationVector:y.Array2HexString(new Uint8Array(this.iv))},n&&(this.oFileInfo.Hidden.ExtendedProps.ParanoidKey=n);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),w.prototype.startUpload=function(){var e=s(regeneratorRuntime.mark((function e(t,n,r,o){var i,s,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.oChunkQueue.isProcessed=!0,e.next=3,f.generateKey();case 3:return this.oKey=e.sent,e.next=6,f.convertKeyToString(this.oKey);case 6:return i=e.sent,e.next=9,R.getCurrentUserPrivateKey();case 9:if(!e.sent||!i){e.next=30;break}return e.next=13,R.getCurrentUserPublicKey();case 13:if(!(s=e.sent)){e.next=27;break}return e.next=17,this.encryptParanoidKey(i,[s]);case 17:if(!(a=e.sent)){e.next=24;break}return e.next=21,this.start(t,a);case 21:this.readChunk(n,r),e.next=25;break;case 24:u.isFunction(o)&&o();case 25:e.next=28;break;case 27:u.isFunction(o)&&o();case 28:e.next=31;break;case 30:u.isFunction(o)&&o();case 31:case"end":return e.stop()}}),e,this)})));return function(t,n,r,o){return e.apply(this,arguments)}}(),w.prototype.readChunk=function(e,t){var n=this.iChunkSize*this.iCurrChunk,r=this.iCurrChunk<this.iChunkNumber-1?this.iChunkSize*(this.iCurrChunk+1):this.oFile.size,o=new FileReader,i=null;if(-1!==this.aStopList.indexOf(e))return this.aStopList.splice(this.aStopList.indexOf(e),1),void this.checkQueue();if(this.oFile.slice?i=this.oFile.slice(n,r):this.oFile.webkitSlice?i=this.oFile.webkitSlice(n,r):this.oFile.mozSlice&&(i=this.oFile.mozSlice(n,r)),i)try{o.onloadend=u.bind((function(n){n.target.readyState===FileReader.DONE&&(this.oChunk=n.target.result,this.iCurrChunk++,this.encryptChunk(e,t))}),this),o.readAsArrayBuffer(i)}catch(e){l.showError(p.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_ENCRYPTION"))}},w.prototype.encryptChunk=function(e,t){crypto.subtle.encrypt({name:"AES-CBC",iv:this.iv},this.oKey,this.oChunk).then(u.bind((function(n){n=this.iChunkNumber>1&&this.iCurrChunk!==this.iChunkNumber?n.slice(0,n.byteLength-16):n;var r=new Blob([n],{type:"text/plain",lastModified:new Date}),o=u.bind((function(e,t){this.iCurrChunk<this.iChunkNumber?this.readChunk(e,t):(this.oChunkQueue.isProcessed=!1,this.checkQueue())}),this);this.oFileInfo.File=r,this.iv=new Uint8Array(n.slice(n.byteLength-16)),1===this.iCurrChunk?this.oFileInfo.Hidden.ExtendedProps.FirstChunk=!0:this.oFileInfo.Hidden.ExtendedProps.FirstChunk=null,this.iCurrChunk==this.iChunkNumber?this.oFileInfo.Hidden.ExtendedProps.Loading=null:this.oFileInfo.Hidden.ExtendedProps.Loading=!0,t(e,this.oFileInfo,o,this.iCurrChunk,this.iChunkNumber,(this.iCurrChunk-1)*this.iChunkSize)}),this)).catch((function(e){l.showError(p.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_ENCRYPTION"))}))},w.prototype.downloadDividedFile=function(){var e=s(regeneratorRuntime.mark((function e(t,n,r,o){var i,s,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=a.length>4&&void 0!==a[4]?a[4]:"",t.startDownloading(),e.next=4,this.prepareKey(t,i);case 4:!1!==(s=e.sent)?new N(t,n,this.iChunkSize,r,o,s):t.stopDownloading();case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r,o){return e.apply(this,arguments)}}(),w.prototype.prepareKey=function(){var e=s(regeneratorRuntime.mark((function e(t){var n,r,o=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.length>1&&void 0!==o[1]?o[1]:"",r="",!n){e.next=10;break}return e.next=5,this.decryptParanoidKey(n);case 5:if(r=e.sent){e.next=8;break}return e.abrupt("return",!1);case 8:e.next=22;break;case 10:if(P.DontRemindMe()){e.next=16;break}return e.next=13,this.showOutdatedEncryptionMethodPopup(t.fileName());case 13:if(e.sent){e.next=16;break}return e.abrupt("return",!1);case 16:if(this.isKeyInStorage()){e.next=22;break}return e.next=19,this.getTemporaryKeyAsString();case 19:if(r=e.sent){e.next=22;break}return e.abrupt("return",!1);case 22:return e.abrupt("return",r);case 23:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),w.prototype.getTemporaryKeyAsString=s(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Promise((function(e,t){E.showPopup(b,[function(t){e(t)},function(){e(!1)}])})),e.next=3,t;case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)}))),w.prototype.showOutdatedEncryptionMethodPopup=function(){var e=s(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Promise((function(e,n){E.showPopup(C,[t,function(){e(!0)},function(){e(!1)}])})),e.next=3,n;case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),w.prototype.encryptParanoidKey=function(){var e=s(regeneratorRuntime.mark((function e(t,n){var r,o,i,s,a,u,c=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=c.length>2&&void 0!==c[2]?c[2]:"",o="",e.next=4,R.getCurrentUserPrivateKey();case 4:if(!(i=e.sent)){e.next=10;break}return e.next=8,R.encryptData(t,n,[i],!1,!0,r);case 8:(s=e.sent).result?(a=s.result,u=a.data,a.password,o=u):(s.hasErrors()||s.hasNotices())&&R.showPgpErrorByCode(s,"",p.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY"));case 10:return e.abrupt("return",o);case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),w.prototype.decryptParanoidKey=function(){var e=s(regeneratorRuntime.mark((function e(t){var n,o,i,s,a,c,h,f=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=f.length>1&&void 0!==f[1]?f[1]:"",o="",e.next=4,R.decryptData(t,n);case 4:if(!(i=e.sent).result){e.next=17;break}if(o=i.result,!i.validKeyNames||!i.validKeyNames.length){e.next=14;break}return e.next=10,R.getCurrentUserPrivateKey();case 10:(s=e.sent)&&i.validKeyNames.includes(s.getUser())||(a=p.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/REPORT_SUCCESSFULL_SIGNATURE_VERIFICATION")+i.validKeyNames.join(", ").replace(/</g,"&lt;").replace(/>/g,"&gt;"),l.showReport(a)),e.next=15;break;case 14:i.notices&&-1!==u.indexOf(i.notices,Enums.OpenPgpErrors.VerifyErrorNotice)&&l.showError(p.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_SIGNATURE_NOT_VERIFIED"));case 15:e.next=18;break;case 17:(i.hasErrors()||i.hasNotices())&&(c=i.errors?i.errors:[],h=i.notices?i.notices:[],[].concat(r(c),r(h)).some((function(e){return e.length&&e[0]===Enums.OpenPgpErrors.PrivateKeyNotFoundError}))?l.showError(p.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_NO_PRIVATE_KEY_FOUND_FOR_DECRYPT")):R.showPgpErrorByCode(i,"",p.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY")));case 18:return e.abrupt("return",o);case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),w.prototype.checkQueue=function(){var e=null;this.oChunkQueue.aFiles.length>0&&(e=this.oChunkQueue.aFiles.shift()).fStartUploadCallback.apply(e.fStartUploadCallback,[e.oFileInfo,e.sUid,e.fOnChunkEncryptCallback])},w.prototype.stopUploading=function(e,t,n){var r=!1;this.oChunkQueue.aFiles.forEach((function(n,o,i){n.sUid===e&&(t(e,n.oFileInfo.FileName),i.splice(o,1),r=!0)})),r||(this.aStopList.push(e),this.oChunkQueue.isProcessed=!1,t(e,n),this.oKey=null)},w.prototype.viewEncryptedImage=function(){var e=s(regeneratorRuntime.mark((function e(t,n){var r,o,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>2&&void 0!==i[2]?i[2]:"",t.startDownloading(),e.next=4,this.prepareKey(t,r);case 4:!1!==(o=e.sent)?new m(t,n,this.iChunkSize,o):t.stopDownloading();case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),w.prototype.isKeyInStorage=function(){return!!f.loadKeyFromStorage()},N.prototype.init=function(){var e=s(regeneratorRuntime.mark((function e(t,n,r,o,i){var s,a,c=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.sHash=d.getRandomHash(),this.oFile=t,this.sFileName=t.fileName(),this.iFileSize=t.size(),this.sDownloadLink=t.getActionUrl("download"),this.iCurrChunk=0,this.iv=new Uint8Array(y.HexString2Array(n)),this.key=null,this.iChunkNumber=Math.ceil(this.iFileSize/r),this.iChunkSize=r,this.fProcessBlobErrorCallback=o,this.sDownloadLink.indexOf("&")>0&&(this.sDownloadLink=this.sDownloadLink.substring(0,this.sDownloadLink.indexOf("&"))),s=function(){u.isFunction(c.fProcessBlobErrorCallback)&&c.fProcessBlobErrorCallback(),c.stopDownloading()},!i){e.next=20;break}return e.next=16,f.getKeyFromString(i);case 16:(a=e.sent)?(this.key=a,this.decryptChunk()):s(),e.next=21;break;case 20:f.getKey((function(e){c.key=e,c.decryptChunk()}),s);case 21:case"end":return e.stop()}}),e,this)})));return function(t,n,r,o,i){return e.apply(this,arguments)}}(),N.prototype.writeChunk=function(e){!0===this.oFile.downloading()&&(this.oWriter.write(e),this.iCurrChunk<this.iChunkNumber?this.decryptChunk():(this.stopDownloading(),this.oWriter.close()))},N.prototype.decryptChunk=function(){var e=new XMLHttpRequest;e.open("GET",this.getChunkLink(),!0),e.responseType="arraybuffer",e.onprogress=u.bind((function(t){this.isDownloading()?this.oFile.onDownloadProgress(t.loaded+(this.iCurrChunk-1)*this.iChunkSize,this.iFileSize):e.abort()}),this),e.onload=u.bind((function(t){var n=e.response,r={};200===e.status&&n&&((r=new Uint8Array(n.byteLength+16)).set(new Uint8Array(n),0),this.iCurrChunk!==this.iChunkNumber?crypto.subtle.encrypt({name:"AES-CBC",iv:new Uint8Array(n.slice(n.byteLength-16))},this.key,new Uint8Array([16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16]).buffer).then(u.bind((function(e){r.set(new Uint8Array(new Uint8Array(e.slice(0,16))),n.byteLength),crypto.subtle.decrypt({name:"AES-CBC",iv:this.iv},this.key,r.buffer).then(u.bind((function(e){var t=new Uint8Array(e);this.iv=new Uint8Array(n.slice(n.byteLength-16)),this.writeChunk(t)}),this)).catch(u.bind((function(e){this.stopDownloading(),u.isFunction(this.fProcessBlobErrorCallback)&&this.fProcessBlobErrorCallback(),l.showError(p.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_DECRYPTION"))}),this))}),this)):crypto.subtle.decrypt({name:"AES-CBC",iv:this.iv},this.key,n).then(u.bind((function(e){var t=new Uint8Array(e);this.iv=new Uint8Array(n.slice(n.byteLength-16)),this.writeChunk(t)}),this)).catch(u.bind((function(e){this.stopDownloading(),u.isFunction(this.fProcessBlobErrorCallback)&&this.fProcessBlobErrorCallback(),l.showError(p.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_DECRYPTION"))}),this)))}),this),e.send(null)},N.prototype.stopDownloading=function(){this.oFile.stopDownloading()},N.prototype.getChunkLink=function(){return this.sDownloadLink+"/download/"+this.iCurrChunk+++"/"+this.iChunkSize+"&"+this.sHash},N.prototype.isDownloading=function(){return this.oFile.downloading()},m.prototype=Object.create(N.prototype),m.prototype.constructor=m,m.prototype.writeChunk=function(e){this.oWriter=null===this.oWriter?new O(this.sFileName):this.oWriter,this.oWriter.write(e),this.iCurrChunk<this.iChunkNumber?this.decryptChunk():(this.stopDownloading(),this.oWriter.close())},g.prototype.write=function(e){this.aBuffer.push(e)},g.prototype.close=function(){var e=new Blob(this.aBuffer);void 0!==this.fProcessBlobCallback?this.fProcessBlobCallback(e):h.saveAs(e,this.sName),e=null},O.prototype=Object.create(g.prototype),O.prototype.constructor=O,O.prototype.close=function(){try{var e=new Blob(this.aBuffer),t=window.URL.createObjectURL(e);this.imgWindow.document.write("<head><title>"+this.sName+'</title></head><body><img src="'+t+'" /></body>'),a(this.imgWindow.document.body).find("img").on("load",(function(){window.URL.revokeObjectURL(t)}))}catch(e){l.showError(p.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_POPUP_WINDOWS"))}},e.exports=new w},TrqT:function(e,t,n){"use strict";var r=n("F/us"),o=n("0h2I"),i=n("czxF"),s=n("RN+F"),a=n("SQrT");function u(){i.call(this),this.key=o.observable(""),this.fOnKeyEnterCallback=null,this.fOnCancellCallback=null}r.extendOwn(u.prototype,i.prototype),u.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_GetTemporaryKeyPopup",u.prototype.onOpen=function(e,t){this.key(""),this.fOnKeyEnterCallback=e,this.fOnCancellCallback=t},u.prototype.cancel=function(){this.fOnCancellCallback(),this.closePopup()},u.prototype.enterKey=function(){""===this.key()?a.showError(s.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_KEY_CANT_BE_BLANK")):(this.fOnKeyEnterCallback(this.key()),this.closePopup())},e.exports=new u},Z2LC:function(e,t,n){"use strict";function r(e,t,n,r,o,i,s){try{var a=e[i](s),u=a.value}catch(e){return void n(e)}a.done?t(u):Promise.resolve(u).then(r,o)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(o,i){var s=e.apply(t,n);function a(e){r(s,o,i,a,u,"next",e)}function u(e){r(s,o,i,a,u,"throw",e)}a(void 0)}))}}var i=n("F/us"),s=n("0h2I"),a=n("RN+F"),u=n("AFLV"),c=n("czxF"),l=n("76Kh"),p=n("1grR");function h(){c.call(this),this.fileName=s.observable(""),this.iv=s.observable(""),this.oldEncryptionMode=s.observable(!1),this.encryptedParanoidKey=""}i.extendOwn(h.prototype,c.prototype),h.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_InitializationVectorPopup",h.prototype.onOpen=function(e,t){this.oFile=e,this.fileName(e.fileName()),this.iv(t);var n=e&&e.oExtendedProps,r=n&&(e.sharedWithMe()?n.ParanoidKeyShared:n.ParanoidKey);this.encryptedParanoidKey=r,this.oldEncryptionMode(!r)},h.prototype.downloadEncrypted=function(){var e;i.isFunction(null===(e=this.oFile)||void 0===e?void 0:e.downloadFile)&&this.oFile.downloadFile(!0)},h.prototype.getAesKey=o(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n("QJDP"),e.next=3,t.decryptParanoidKey(this.encryptedParanoidKey);case 3:r=e.sent,u.isNonEmptyString(r)&&l.showPopup(p,[r,null,a.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/HEADING_IV_AES_KEY")]);case 5:case"end":return e.stop()}}),e,this)}))),e.exports=new h},c2EW:function(e,t,n){"use strict";var r=n("F/us"),o=n("0h2I"),i=n("RN+F"),s=n("czxF");function a(){s.call(this),this.fEncrypt=null,this.fUpload=null,this.fCancel=null,this.message=o.observable(""),this.filesConfirmText=o.observable("")}r.extendOwn(a.prototype,s.prototype),a.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_ConfirmEncryptionPopup",a.prototype.onOpen=function(e,t,n,o,s){var a=r.map(s,(function(e){return i.encodeHtml(e)}));this.filesConfirmText(""),this.fEncrypt=e,this.fUpload=t,this.fCancel=n,this.message(i.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/CONFIRM_ENCRYPT_PLURAL",{VALUE:o>1?o:'"'+s[0]+'"'},null,o)),o>1&&this.filesConfirmText(a.join("<br />"))},a.prototype.cancelUpload=function(){this.fCancel(),this.closePopup()},a.prototype.encrypt=function(){this.fEncrypt(),this.closePopup()},a.prototype.upload=function(){this.fUpload(),this.closePopup()},e.exports=new a},hJUJ:function(e,t,n){"use strict";var r=n("F/us"),o=n("0h2I"),i=n("o0Bx"),s=n("I5pT"),a=n("RN+F"),u=n("czxF");function c(){u.call(this),this.message=o.observable(""),this.dontRemindMe=o.observable(!1),this.fContinueCallback=null,this.fCancelCallback=null}r.extendOwn(c.prototype,u.prototype),c.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_OutdatedEncryptionMethodPopup",c.prototype.onOpen=function(e,t,n){this.message(a.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/MESSAGE_OUTDATED_ENCRYPTION_METHOD",{FILENAME:e})),this.fContinueCallback=t,this.fCancelCallback=n},c.prototype.cancel=function(){this.fCancelCallback(),this.closePopup()},c.prototype.continueDownload=function(){this.dontRemindMe()&&i.send("CoreParanoidEncryptionWebclientPlugin","DontRemindMe",{},(function(e){!0===e.Result&&s.DontRemindMe(!0)}),this),this.fContinueCallback(),this.closePopup()},e.exports=new c},"mHl/":function(e,t,n){"use strict";function r(e,t,n,r,o,i,s){try{var a=e[i](s),u=a.value}catch(e){return void n(e)}a.done?t(u):Promise.resolve(u).then(r,o)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(o,i){var s=e.apply(t,n);function a(e){r(s,o,i,a,u,"next",e)}function u(e){r(s,o,i,a,u,"throw",e)}a(void 0)}))}}var i=n("F/us"),s=n("EVdn"),a=n("0h2I"),u=n("RN+F"),c=(n("AFLV"),n("OgeD")),l=n("SQrT"),p=c.run("SettingsWebclient","getAbstractSettingsFormViewClass"),h=n("76Kh"),f=n("zDR0"),d=n("I5pT"),y=n("Npm9"),E=n("2kfa"),C=n("t19A"),b=n("nTW+"),P=n("wjWM"),R=c.run("OpenPgpWebclient","getOpenPgpEncryptor");function w(){p.call(this,d.ServerModuleName),this.enableJscrypto=a.observable(d.enableJscrypto()),this.enableInPersonalStorage=a.observable(d.EnableInPersonalStorage),this.keyName=a.observable(""),this.bIsHttpsEnable="https:"===window.location.protocol,this.allowChangeSettings=a.observable(d.AllowChangeSettings),this.isImporting=a.observable(!1),this.exportKeyBound=i.bind(this.exportKey,this),this.isPGPKeysAvailable=a.observable(!0),a.isObservable(f.keyName)&&f.keyName.subscribe((function(){this.keyName(f.keyName())}),this),this.allowKeysManagement=a.observable(!!this.keyName()),this.keyName.subscribe((function(){this.keyName()&&this.allowKeysManagement(!0)}),this)}i.extendOwn(w.prototype,p.prototype),w.prototype.ViewTemplate="CoreParanoidEncryptionWebclientPlugin_ParanoidEncryptionSettingsFormView",w.prototype.enableBackwardCompatibility=function(){this.allowKeysManagement(!0)},w.prototype.importFileKey=function(){s("#import-key-file").click()},w.prototype.importStringKey=function(){h.showPopup(y)},w.prototype.readKeyFromFile=function(){var e,t=document.getElementById("import-key-file"),n=t.files[0],r=new FileReader,o="",s=t.files[0].name.split("."),a=i.bind((function(){this.isImporting(!1)}),this),c=i.bind((function(){this.isImporting(!1)}),this);if(s.splice(s.length-1,1),e=s.join(""),n){this.isImporting(!0),r.onload=function(t){o=t.target.result,f.importKeyFromString(e,o,a,c)};try{r.readAsText(n)}catch(e){l.showError(u.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_IMPORT_KEY"))}}else l.showError(u.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_IMPORT_KEY"))},w.prototype.generateNewKey=function(){h.showPopup(E,[i.bind((function(){h.showPopup(C,[this.exportKeyBound,this.keyName()])}),this)])},w.prototype.removeJscryptoKey=function(){var e=i.bind((function(e){e&&(f.deleteKey().error&&l.showError(u.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_DELETE_KEY")))}),this);h.showPopup(b,[this.exportKeyBound,this.keyName(),e])},w.prototype.getCurrentValues=function(){return[this.enableJscrypto(),this.enableInPersonalStorage()]},w.prototype.revertGlobalValues=function(){this.enableJscrypto(d.enableJscrypto()),this.enableInPersonalStorage(d.EnableInPersonalStorage)},w.prototype.getParametersForSave=function(){return{EnableModule:this.enableJscrypto(),EnableInPersonalStorage:this.enableInPersonalStorage()}},w.prototype.applySavedValues=function(){d.update(this.enableJscrypto(),this.enableInPersonalStorage())},w.prototype.onShow=o(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f.loadKeyNameFromStorage(),e.next=3,R.isPrivateKeyAvailable();case 3:t=e.sent,this.isPGPKeysAvailable(t),this.allowKeysManagement(!!this.keyName());case 6:case"end":return e.stop()}}),e,this)}))),w.prototype.exportKey=function(){var e=null,t=null,n=document.createElement("a");f.getKey(i.bind((function(r){r?f.exportKey().then(i.bind((function(r){e=new Blob([P.Array2HexString(new Uint8Array(r))],{type:"text/plain"}),t=window.URL.createObjectURL(e),document.body.appendChild(n),n.style="display: none",n.href=t,n.download=this.keyName(),n.click(),window.URL.revokeObjectURL(t)}),this)).catch((function(){l.showError(u.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY"))})):l.showError(u.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY"))}),this),!1,!1,!0)},e.exports=new w},mtgd:function(e,t,n){"use strict";(function(t){var r=n("F/us"),o=n("0h2I"),i=n("czxF"),s=n("RN+F"),a=n("SQrT");function u(){i.call(this),this.keyPassword=o.observable(""),this.keyPasswordConfirm=o.observable(""),this.fOnPasswordEnterCallback=null,this.fOnWrongPasswordCallback=null,this.fOnCancellCallback=null}r.extendOwn(u.prototype,i.prototype),u.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_EncryptKeyPasswordPopup",u.prototype.onOpen=function(e,t){this.fOnPasswordEnterCallback=e,this.fOnCancellCallback=t},u.prototype.encryptKey=function(){""===t.trim(this.keyPassword())?this.showError(s.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_PASSWORD_CANT_BE_BLANK")):t.trim(this.keyPassword())!==t.trim(this.keyPasswordConfirm())?this.showError(s.i18n("COREWEBCLIENT/ERROR_PASSWORDS_DO_NOT_MATCH")):(r.isFunction(this.fOnPasswordEnterCallback)&&this.fOnPasswordEnterCallback(t.trim(this.keyPassword())),this.closePopup())},u.prototype.cancelPopup=function(){r.isFunction(this.fOnCancellCallback)&&this.fOnCancellCallback(),this.closePopup()},u.prototype.onShow=function(){this.keyPassword(""),this.keyPasswordConfirm("")},u.prototype.showError=function(e){a.showError(e)},e.exports=new u}).call(this,n("EVdn"))},"nTW+":function(e,t,n){"use strict";var r=n("F/us"),o=n("0h2I"),i=n("RN+F"),s=n("czxF"),a=n("76Kh"),u=n("20Ah");function c(){s.call(this),this.fExportKeyCallback=null,this.keyName=o.observable(""),this.fDelete=null,this.fDeleteCallback=null}r.extendOwn(c.prototype,s.prototype),c.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_DeleteKeyPopup",c.prototype.onOpen=function(e,t,n){r.isFunction(e)&&(this.fExportKeyCallback=r.bind((function(){this.closePopup(),e()}),this)),this.keyName(t),this.fDeleteCallback=r.bind((function(e){n.call(this,e),e?this.closePopup():this.showPopup()}),this)},c.prototype.deleteKey=function(){this.hidePopup(),a.showPopup(u,[i.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/CONFIRM_DELETE_KEY"),this.fDeleteCallback])},e.exports=new c},oBzO:function(e,t,n){"use strict";var r=n("F/us"),o=n("RN+F"),i=n("Yjhd"),s=n("o0Bx"),a=n("IAk5"),u=n("HLSX"),c=n("SQrT"),l=n("76Kh"),p=n("20Ah"),h=n("c2EW"),f=n("2d9n"),d=n("Z2LC"),y=n("I5pT"),E=null,C=[],b=!1,P=null;function R(){return"https:"===window.location.protocol}function w(e){e.run("SettingsWebclient","registerSettingsTab",[function(){return n("mHl/")},y.HashModuleName,o.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/LABEL_SETTINGS_TAB")]),a.subscribeEvent("AbstractFileModel::FileDownload::before",(function(e){if(e.File&&e.File.IS_FILE){var t=e.File,n=(null==t?void 0:t.oExtendedProps)||!1,r=(null==n?void 0:n.InitializationVector)||!1,i=(null==n?void 0:n.ParanoidKey)||!1,s=(null==n?void 0:n.ParanoidKeyShared)||!1,u=t.sOwnerName===a.getUserPublicId(),l=t.sharedWithMe();y.enableJscrypto()&&r&&(u||l)&&(R()?e.CustomDownloadHandler=function(){E.downloadDividedFile(t,r,null,null,l&&s?s:i)}:(c.showError(o.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_HTTPS_NEEDED")),e.CancelDownload=!0))}})),a.subscribeEvent("Jua::FileUpload::before",(function(e){var t=e.sUid,n=e.sModuleName,i=e.oFileInfo,s=e.fOnChunkReadyCallback,a=e.fRegularUploadFileCallback,u=e.fCancelFunction,p=function(e,t,n){!y.AllowMultiChunkUpload&&e.File.size>E.iChunkSize?(c.showError(o.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_FILE_SIZE_LIMIT",{VALUE:y.ChunkSizeMb})),u(t),E.oChunkQueue.isProcessed=!1,E.checkQueue()):E.startUpload(e,t,n,r.bind((function(){u(t),E.oChunkQueue.isProcessed=!1,E.checkQueue()}),this))},d=r.bind((function(){C.forEach((function(e){a(e.sUid,e.oFileInfo)})),C=[],b=!1}),this),P=r.bind((function(){C.forEach((function(e){E.oChunkQueue.aFiles.push({fStartUploadCallback:p,oFileInfo:e.oFileInfo,sUid:e.sUid,fOnChunkEncryptCallback:s})})),C=[],b=!1,E.oChunkQueue.isProcessed||(E.oChunkQueue.isProcessed=!0,E.checkQueue())})),w=r.bind((function(){C.forEach((function(e){u(e.sUid)})),C=[],b=!1}));y.enableJscrypto()&&y.EncryptionAllowedModules&&y.EncryptionAllowedModules.length>0&&y.EncryptionAllowedModules.includes(n)&&("encrypted"===e.sStorageType||"personal"===e.sStorageType&&y.EnableInPersonalStorage)?R()?"personal"===e.sStorageType&&y.EnableInPersonalStorage?(b||(setTimeout((function(){l.showPopup(h,[P,d,w,C.length,r.map(C,(function(e){return e.oFileInfo.FileName}))])}),10),b=!0),C.push({sUid:t,oFileInfo:i})):!0===E.oChunkQueue.isProcessed?E.oChunkQueue.aFiles.push({fStartUploadCallback:p,oFileInfo:i,sUid:t,fOnChunkEncryptCallback:s}):p(i,t,s):"personal"===e.sStorageType&&y.EnableInPersonalStorage?function(e,t,n,o,i){b||(setTimeout((function(){l.showPopup(f,[n,o,C.length,r.map(C,(function(e){return e.oFileInfo.FileName})),i])}),10),b=!0),C.push({sUid:e,oFileInfo:t})}(t,i,d,w,o.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_HTTPS_NEEDED")):(c.showError(o.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_HTTPS_NEEDED")),u(t)):a(t,i)})),a.subscribeEvent("CFilesView::FileDownloadCancel",(function(e){y.enableJscrypto()&&R()&&e.oFile.stopDownloading()})),a.subscribeEvent("CFilesView::FileUploadCancel",(function(e){y.enableJscrypto()&&R()?(E.oChunkQueue.aFiles.forEach((function(t,n,r){e.fOnUploadCancelCallback(t.sUid,t.oFileInfo.FileName)})),E.oChunkQueue.aFiles=[],E.stopUploading(e.sFileUploadUid,e.fOnUploadCancelCallback,e.sFileUploadName)):r.isFunction(e.fOnUploadCancelCallback)&&e.fOnUploadCancelCallback(e.sFileUploadUid,e.sFileUploadName)})),a.subscribeEvent("Jua::FileUploadingError",(function(){y.enableJscrypto()&&R()&&(E.oChunkQueue.isProcessed=!1,E.checkQueue())})),a.subscribeEvent("FilesWebclient::ParseFile::after",(function(e){var t=e[0],n=(null==t?void 0:t.oExtendedProps)||!1,r=(null==n?void 0:n.InitializationVector)||!1,o=!!r,i=(null==n?void 0:n.ParanoidKey)||!1,s=(null==n?void 0:n.ParanoidKeyShared)||!1,u=/\.(png|jpe?g|gif)$/.test(t.fileName().toLowerCase()),c=t.sOwnerName===a.getUserPublicId(),p=t.sharedWithMe();o&&(t.thumbnailSrc(""),(c||p)&&u&&y.enableJscrypto()?t.oActionsData.view.Handler=function(){E.viewEncryptedImage(t,r,p&&s?s:i)}:t.removeAction("view"),t.removeAction("list"),t.bIsSecure(!0),t.onSecureIconClick=function(e){l.showPopup(d,[t,r])})})),a.subscribeEvent("FileViewerWebclientPlugin::FilesCollection::after",(function(e){e.aFilesCollection(r.filter(e.aFilesCollection(),(function(e){return!(void 0!==e.oExtendedProps&&void 0!==e.oExtendedProps.InitializationVector)})))})),y.enableJscrypto.subscribe((function(e){null!==P&&P.requestStorages()})),a.subscribeEvent("FilesWebclient::ConstructView::after",(function(t){if("CFilesView"===t.Name){P=t.View;var n=e.run("MailWebclient","getComposeMessageWithAttachments");r.isFunction(n)&&(P.executeSend=function(){var e=this.selector.listCheckedAndSelected(),t=r.filter(e,(function(e){return e&&e.IS_FILE}),this),i=!1,a=r.map(t,(function(e){var t=!(!e.oExtendedProps||!e.oExtendedProps.InitializationVector);return i=i||t,{Storage:e.storageType(),Path:e.path(),Name:e.fileName(),Id:e.id(),IsEncrypted:t}}));this.bAllowSendEmails&&t.length>0&&(i?l.showPopup(p,[o.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ALERT_SEND_ENCRYPTED_FILES"),function(e){e&&s.send("Files","SaveFilesAsTempFiles",{Files:a},(function(e){e.Result&&n(e.Result)}),this)}.bind(this)]):s.send("Files","SaveFilesAsTempFiles",{Files:a},(function(e){e.Result&&n(e.Result)}),this))},P.sendCommand=i.createCommand(P,P.executeSend,(function(){if(!this.isZipFolder()&&this.allSelectedFilesReady()){var e=this.selector.listCheckedAndSelected();return r.filter(e,(function(e){return e&&e.IS_FILE}),this).length>0}return!1})))}}));var t=n("MYcH");a.subscribeEvent("SharedFiles::UpdateShare::before",t.onBeforeUpdateShare),a.subscribeEvent("SharedFiles::OpenFilesSharePopup",(function(e){e.IsDir&&e.DialogHintText(o.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/INFO_SHARING_FOLDER"))}))}e.exports=function(e){return y.init(e),{start:function(e){E=n("QJDP"),e.run("OpenPgpWebclient","getOpenPgpEncryptor"),window.Blob&&window.URL&&r.isFunction(window.URL.createObjectURL)&&(u.chrome&&!R()?w(e):window.crypto&&window.crypto.subtle&&(u.edge||w(e)))}}}},t19A:function(e,t,n){"use strict";var r=n("F/us"),o=n("0h2I"),i=n("czxF");function s(){i.call(this),this.fExportKeyCallback=null,this.keyName=o.observable("")}r.extendOwn(s.prototype,i.prototype),s.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_ExportInformationPopup",s.prototype.onOpen=function(e,t){r.isFunction(e)&&(this.fExportKeyCallback=r.bind((function(){this.closePopup(),e()}),this)),this.keyName(t)},e.exports=new s},"uN/E":function(e,t,n){var r,o=o||function(e){"use strict";if(!(void 0===e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=e.document,n=function(){return e.URL||e.webkitURL||e},r=t.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in r,i=/constructor/i.test(e.HTMLElement)||e.safari,s=/CriOS\/[\d]+/.test(navigator.userAgent),a=function(t){(e.setImmediate||e.setTimeout)((function(){throw t}),0)},u=function(e){setTimeout((function(){"string"==typeof e?n().revokeObjectURL(e):e.remove()}),4e4)},c=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},l=function(t,l,p){p||(t=c(t));var h,f=this,d="application/octet-stream"===t.type,y=function(){!function(e,t,n){for(var r=(t=[].concat(t)).length;r--;){var o=e["on"+t[r]];if("function"==typeof o)try{o.call(e,n||e)}catch(e){a(e)}}}(f,"writestart progress write writeend".split(" "))};if(f.readyState=f.INIT,o)return h=n().createObjectURL(t),void setTimeout((function(){var e,t;r.href=h,r.download=l,e=r,t=new MouseEvent("click"),e.dispatchEvent(t),y(),u(h),f.readyState=f.DONE}));!function(){if((s||d&&i)&&e.FileReader){var r=new FileReader;return r.onloadend=function(){var t=s?r.result:r.result.replace(/^data:[^;]*;/,"data:attachment/file;");e.open(t,"_blank")||(e.location.href=t),t=void 0,f.readyState=f.DONE,y()},r.readAsDataURL(t),void(f.readyState=f.INIT)}(h||(h=n().createObjectURL(t)),d)?e.location.href=h:e.open(h,"_blank")||(e.location.href=h);f.readyState=f.DONE,y(),u(h)}()},p=l.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return t=t||e.name||"download",n||(e=c(e)),navigator.msSaveOrOpenBlob(e,t)}:(p.abort=function(){},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null,function(e,t,n){return new l(e,t||e.name||"download",n)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);e.exports?e.exports.saveAs=o:null!==n("B9Yq")&&null!==n("PDX0")&&(void 0===(r=function(){return o}.call(t,n,t,e))||(e.exports=r))},wjWM:function(e,t,n){"use strict";var r=n("F/us"),o={Array2HexString:function(e){var t="";return r.each(e,(function(e){var n=e.toString(16);t+=(1===n.length?"0":"")+n})),t},HexString2Array:function(e){var t=[];if(0===e.length||e.length%2!=0)return t;for(var n=0;n<e.length;n+=2)t.push(parseInt(e.substr(n,2),16));return t}};e.exports=o},zDR0:function(e,t,n){"use strict";function r(e,t,n,r,o,i,s){try{var a=e[i](s),u=a.value}catch(e){return void n(e)}a.done?t(u):Promise.resolve(u).then(r,o)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(o,i){var s=e.apply(t,n);function a(e){r(s,o,i,a,u,"next",e)}function u(e){r(s,o,i,a,u,"throw",e)}a(void 0)}))}}var i=n("F/us"),s=n("0h2I"),a=n("RN+F"),u=n("gcBV"),c=n("SQrT"),l=n("hPb3"),p=n("wjWM"),h=n("76Kh"),f=n("LU2F"),d=n("mtgd");function y(){this.sPrefix="user_"+(l.UserId||"0")+"_",this.key=s.observable(),this.keyName=s.observable(),this.storageName="cryptoKeyEncrypted"}y.prototype.key=null,y.prototype.sPrefix="",y.prototype.getKey=function(e,t,n,r){var o=this.loadKeyFromStorage(),s=new Promise(function(e,s){var u=i.bind((function(t){this.decryptKeyData(o,t).then(i.bind((function(t){this.generateKeyFromArray(t).then((function(t){e(t)})).catch((function(e){s(new Error(a.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY")))}))}),this)).catch((function(e){s(new Error(a.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY")))}))}),this);o?!this.key()||r?n?u(n):h.showPopup(f,[u,function(){i.isFunction(t)&&t()}]):e(this.key()):s(new Error(a.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/INFO_EMPTY_JSCRYPTO_KEY")))}.bind(this));this.loadKeyNameFromStorage(),s.then(i.bind((function(t){this.onKeyGenerateSuccess(t),i.isFunction(e)&&e(t)}),this)).catch(i.bind((function(e){i.isFunction(t)&&t(),this.onKeyGenerateError(e)}),this))},y.prototype.loadKeyNameFromStorage=function(){u.hasData(this.getStorageName())&&this.keyName(u.getData(this.getStorageName()).keyname)},y.prototype.loadKeyFromStorage=function(){var e="";return u.hasData(this.getStorageName())&&(e=u.getData(this.getStorageName()).keydata),e},y.prototype.generateKeyFromArray=function(e){return window.crypto.subtle.importKey("raw",e,{name:"AES-CBC"},!0,["encrypt","decrypt"])},y.prototype.onKeyGenerateSuccess=function(e){this.key(e)},y.prototype.onKeyGenerateError=function(e){e&&e.message&&c.showError(e.message)},y.prototype.generateKey=o(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=!1,e.prev=1,e.next=4,window.crypto.subtle.generateKey({name:"AES-CBC",length:256},!0,["encrypt","decrypt"]);case 4:t=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),c.showError(a.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_GENERATE_KEY"));case 10:return e.abrupt("return",t);case 11:case"end":return e.stop()}}),e,null,[[1,7]])}))),y.prototype.convertKeyToString=function(){var e=o(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n="",!t){e.next=12;break}return e.prev=2,e.next=5,window.crypto.subtle.exportKey("raw",t);case 5:r=e.sent,n=p.Array2HexString(new Uint8Array(r)),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),c.showError(a.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_EXPORT_KEY"));case 12:return e.abrupt("return",n);case 13:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t){return e.apply(this,arguments)}}(),y.prototype.generateAndExportKey=function(){var e=o(regeneratorRuntime.mark((function e(t,n){var r,s,l=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.generateKey();case 2:return r=e.sent,e.next=5,this.convertKeyToString(r);case 5:s=e.sent,h.showPopup(d,[function(){var e=o(regeneratorRuntime.mark((function e(o){var p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l.encryptKeyData(s,o);case 3:p=e.sent,u.setData(l.getStorageName(),{keyname:n,keydata:p}),l.loadKeyNameFromStorage(),l.onKeyGenerateSuccess(r),i.isFunction(t)&&t(),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),c.showError(a.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY"));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),function(){}]);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),y.prototype.getKeyFromString=function(){var e=o(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null,(r=p.HexString2Array(t)).length>0?r=new Uint8Array(r):c.showError(a.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY")),e.prev=3,e.next=6,this.generateKeyFromArray(r);case 6:n=e.sent,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),c.showError(a.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY"));case 12:return e.abrupt("return",n);case 13:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(t){return e.apply(this,arguments)}}(),y.prototype.importKeyFromString=function(e,t,n,r){try{h.showPopup(d,[i.bind((function(o){this.encryptKeyData(t,o).then(i.bind((function(t){u.setData(this.getStorageName(),{keyname:e,keydata:t}),this.getKey(n,r,o)}),this)).catch((function(){c.showError(a.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY")),i.isFunction(r)&&r()}))}),this),function(){i.isFunction(r)&&r()}])}catch(e){c.showError(a.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_IMPORT_KEY")),i.isFunction(r)&&r()}},y.prototype.exportKey=function(){return window.crypto.subtle.exportKey("raw",this.key())},y.prototype.deleteKey=function(){try{this.key(null),this.keyName(null),u.removeData(this.getStorageName())}catch(e){return{error:e}}return{status:"ok"}},y.prototype.decryptKeyData=function(e,t){var n=new Uint8Array(16);return new Promise(function(r,o){e?this.deriveKeyFromPasswordPromise(t,i.bind((function(t){crypto.subtle.decrypt({name:"AES-CBC",iv:n},t,new Uint8Array(p.HexString2Array(e))).then(i.bind((function(e){r(new Uint8Array(e))}),this)).catch((function(){o(new Error(a.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY")))}))}),this),(function(){o(new Error(a.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY")))})):o(new Error(a.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY")))}.bind(this))},y.prototype.encryptKeyData=function(e,t){var n=null,r=null,o=new Uint8Array(16);return new Promise(function(s,u){e?((n=p.HexString2Array(e)).length>0?n=new Uint8Array(n):u(new Error(a.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY"))),this.deriveKeyFromPasswordPromise(t,i.bind((function(e){crypto.subtle.encrypt({name:"AES-CBC",iv:o},e,n).then(i.bind((function(e){r=p.Array2HexString(new Uint8Array(e)),s(r)}),this)).catch((function(){u(new Error(a.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY")))}))}),this),(function(){u(new Error(a.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY")))}))):u(new Error(a.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY")))}.bind(this))},y.prototype.deriveKeyFromPasswordPromise=function(e,t,n){var r=function(e){if(window.TextEncoder)return new TextEncoder("utf-8").encode(e);for(var t=unescape(encodeURIComponent(e)),n=new Uint8Array(t.length),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n};window.crypto.subtle.importKey("raw",r(e),{name:"PBKDF2"},!1,["deriveKey"]).then(i.bind((function(e){window.crypto.subtle.deriveKey({name:"PBKDF2",salt:r("the salt is this string"),iterations:1e5,hash:"SHA-256"},e,{name:"AES-CBC",length:256},!0,["encrypt","decrypt"]).then((function(e){i.isFunction(t)&&t(e)})).catch((function(){i.isFunction(n)&&n()}))}),this)).catch((function(){i.isFunction(n)&&n()}))},y.prototype.getStorageName=function(){return this.sPrefix+this.storageName},e.exports=new y}}]);